<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solicitud Movilidad Erasmus+ | RC Deportivo</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
    <style>
        /* TIPOGRAFÍAS RCD */
        @font-face {
            font-family: "Display";
            src: url("https://intranet-backend-one.vercel.app/fonts/display.ttf") format("truetype");
        }

        @font-face {
            font-family: "Headline";
            src: url("https://intranet-backend-one.vercel.app/fonts/headline.ttf") format("truetype");
        }

        @font-face {
            font-family: "Text";
            src: url("https://intranet-backend-one.vercel.app/fonts/text.ttf") format("truetype");
        }

        :root {
            --rcd-azul: #0831b6;
            --rcd-marino: #000d33;
            --rcd-dorado: #a49666;
            --rcd-gris-bg: #f8fafc;
            --rcd-border: #e2e8f0;
            --rcd-radius: 16px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "Text", sans-serif;
            background-color: var(--rcd-gris-bg);
            color: var(--rcd-marino);
            padding: 60px 20px;
            line-height: 1.6;
        }

        /* CONTENEDOR CENTRADO */
        .main-wrapper {
            max-width: auto;
            margin: 0 auto;
            background: white;
            border-radius: var(--rcd-radius);
            box-shadow: 0 10px 40px rgba(0, 13, 51, 0.06);
            overflow: hidden;
            border: 1px solid var(--rcd-border);
        }

        /* HEADER */
        .form-header {
            background: linear-gradient(135deg, var(--rcd-azul), var(--rcd-marino));
            color: white;
            padding: 40px;
            text-align: center;
        }

        .header-icon {
            font-size: 2rem;
            margin-bottom: 12px;
            background: rgba(255, 255, 255, 0.12);
            width: 64px;
            height: 64px;
            line-height: 64px;
            border-radius: 50%;
            display: inline-block;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .form-header h1 {
            font-family: "Display", sans-serif;
            font-size: 1.75rem;
            margin-bottom: 6px;
            letter-spacing: -0.5px;
            color: #ffffff;
        }

        .form-header p {
            font-size: 0.9rem;
            opacity: 0.9;
            max-width: 500px;
            margin: 0 auto;
        }

        /* CUERPO */
        .form-content {
            padding: 45px;
        }

        .section-title {
            font-family: "Headline", sans-serif;
            font-size: 1.1rem;
            color: var(--rcd-azul);
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 10px;
            border-bottom: 1px solid #f1f5f9;
            padding-bottom: 10px;
        }

        /* INPUTS */
        .input-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 10px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            font-weight: 700;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            color: #94a3b8;
            margin-bottom: 8px;
        }

        .form-control {
            width: 100%;
            padding: 12px 16px;
            border: 1.5px solid #e2e8f0;
            border-radius: 10px;
            font-family: "Text", sans-serif;
            font-size: 0.95rem;
            transition: all 0.25s ease;
            background: #fff;
            color: var(--rcd-marino);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--rcd-azul);
            box-shadow: 0 0 0 4px rgba(8, 49, 182, 0.06);
        }

        .form-control::placeholder {
            color: #cbd5e1;
        }

        .form-control:read-only {
            background: #f8fafc;
            color: #64748b;
            cursor: not-allowed;
            border-color: #f1f5f9;
        }

        /* OPCIONES */
        .options-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .option-item {
            display: flex;
            align-items: center;
            padding: 10px 16px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1.5px solid #f1f5f9;
            background: #fcfdfe;
        }

        .option-item:hover {
            border-color: var(--rcd-border);
            background: #fff;
        }

        .option-item:has(input:checked) {
            border-color: var(--rcd-azul);
            background: rgba(8, 49, 182, 0.02);
        }

        .option-item input {
            width: 18px;
            height: 18px;
            margin-right: 14px;
            cursor: pointer;
            accent-color: var(--rcd-azul);
        }

        .option-item label {
            margin-bottom: 0;
            color: var(--rcd-marino);
            text-transform: none;
            font-weight: 500;
            font-size: 0.9rem;
            cursor: pointer;
            letter-spacing: normal;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        /* FOOTER */
        .footer-actions {
            background: #fcfdfe;
            padding: 40px;
            text-align: center;
            border-top: 1px solid var(--rcd-border);
        }

        .btn-rcd {
            background: linear-gradient(135deg, var(--rcd-azul), var(--rcd-marino));
            color: white;
            padding: 16px 48px;
            border-radius: 50px;
            border: none;
            font-family: "Headline", sans-serif;
            font-size: 1rem;
            text-transform: uppercase;
            font-weight: 700;
            cursor: pointer;
            letter-spacing: 1px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 6px 20px rgba(0, 13, 51, 0.15);
        }

        .btn-rcd:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 13, 51, 0.2);
        }

        .btn-rcd:disabled {
            filter: grayscale(1);
            opacity: 0.5;
            cursor: not-allowed;
        }

        .msg-box {
            margin-top: 24px;
            padding: 16px;
            border-radius: 12px;
            display: none;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .success {
            background: #f0fdf4;
            color: #166534;
            border: 1px solid #dcfce7;
        }

        .error {
            background: #fef2f2;
            color: #991b1b;
            border: 1px solid #fee2e2;
        }

        @media (max-width: 768px) {

            .input-row,
            .options-grid {
                grid-template-columns: 1fr;
                gap: 0;
            }

            .form-content {
                padding: 30px 20px;
            }

            .main-wrapper {
                border-radius: 0;
                border: none;
            }

            body {
                padding: 0;
            }
        }
    </style>
</head>

<body>

    <!-- WP EMAIL CAPTURE -->
    <span id="wp-user-email-hidden" style="display: none">
        <?php echo is_user_logged_in() ? esc_attr(wp_get_current_user()->user_email) : ''; ?>
    </span>

    <div class="main-wrapper">
        <header class="form-header">
            <div class="header-icon"><i class="fas fa-plane-departure"></i></div>
            <h1>Movilidad Erasmus+</h1>
            <p>Formulario de inscripción para el personal deportivo y de gestión</p>
        </header>

        <form id="ErasmusForm" class="form-content">

            <!-- SECCIÓN 1: IDENTIFICACIÓN -->
            <div class="input-group-wrapper">
                <h2 class="section-title"><i class="fas fa-id-card"></i> Datos del Candidato</h2>

                <div class="input-row">
                    <div class="input-group">
                        <label>Nombre Completo *</label>
                        <input type="text" name="nombre" class="form-control" required placeholder="Nombre y apellidos">
                    </div>
                    <div class="input-group">
                        <label>Email Corporativo *</label>
                        <input type="email" id="email_input" name="email" class="form-control" required
                            placeholder="tuemail@rcdeportivo.es">
                    </div>
                </div>

                <div class="input-row">
                    <div class="input-group">
                        <label>Teléfono de Contacto *</label>
                        <input type="tel" name="telefono" class="form-control" required placeholder="+34 XXX XXX XXX">
                    </div>
                    <div class="input-group">
                        <label>Área / Departamento</label>
                        <input type="text" name="areaDepartamento" class="form-control"
                            placeholder="Ej: Scouting, Finanzas...">
                    </div>
                </div>

                <div class="input-group">
                    <label>Antigüedad en la organización *</label>
                    <div class="options-grid">
                        <div class="option-item">
                            <input type="radio" id="ant_1" name="antiguedad" value="Menos de 1 año" required>
                            <label for="ant_1">Menos de 1 año</label>
                        </div>
                        <div class="option-item">
                            <input type="radio" id="ant_2" name="antiguedad" value="Entre 1 y 3 años">
                            <label for="ant_2">Entre 1 y 3 años</label>
                        </div>
                        <div class="option-item">
                            <input type="radio" id="ant_3" name="antiguedad" value="Más de 3 años">
                            <label for="ant_3">Más de 3 años</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SECCIÓN 2: DESTINOS -->
            <div class="input-group-wrapper" style="margin-top: 40px;">
                <h2 class="section-title"><i class="fas fa-map-marker-alt"></i> Destinos Solicitados</h2>
                <div class="options-list">
                    <div class="option-item">
                        <input type="checkbox" id="m_1" name="paisFechas" value="Podgorica (Montenegro) – 23 feb-1 mar">
                        <label for="m_1">Podgorica (Montenegro) – 23 feb al 1 mar</label>
                    </div>
                    <div class="option-item">
                        <input type="checkbox" id="m_2" name="paisFechas" value="Tirana (Albania) – 16-22 mar">
                        <label for="m_2">Tirana (Albania) – 16 al 22 de mar</label>
                    </div>
                    <div class="option-item">
                        <input type="checkbox" id="m_3" name="paisFechas" value="Sarajevo (Bosnia) – 6-12 abr">
                        <label for="m_3">Sarajevo (Bosnia) – 6 al 12 de abr</label>
                    </div>
                    <div class="option-item">
                        <input type="checkbox" id="m_4" name="paisFechas" value="Pristina (Kosovo) – 20-26 abr">
                        <label for="m_4">Pristina (Kosovo) – 20 al 26 de abr</label>
                    </div>
                    <div class="option-item">
                        <input type="checkbox" id="m_5" name="paisFechas" value="Podgorica (Montenegro) – 18-24 may">
                        <label for="m_5">Podgorica (Montenegro) – 18 al 24 de may</label>
                    </div>
                </div>
            </div>

            <!-- SECCIÓN 3: PERFIL -->
            <div class="input-group-wrapper" style="margin-top: 40px;">
                <h2 class="section-title"><i class="fas fa-graduation-cap"></i> Perfil e Idiomas</h2>
                <div class="input-row">
                    <div class="input-group">
                        <label>Nivel de Inglés *</label>
                        <select name="nivelIngles" class="form-control" required>
                            <option value="">Selecciona nivel</option>
                            <option value="Sin certificación">Sin certificación oficial</option>
                            <option value="B1 (Intermedio)">B1 (Intermedio)</option>
                            <option value="B2 (Avanzado)">B2 (Avanzado)</option>
                            <option value="C1 (Certificado)">C1 (Certificado)</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>¿Experiencia previa Erasmus? *</label>
                        <div class="options-grid">
                            <div class="option-item">
                                <input type="radio" id="exp_s" name="movilidadesPrevias" value="Sí" required>
                                <label for="exp_s">Sí</label>
                            </div>
                            <div class="option-item">
                                <input type="radio" id="exp_n" name="movilidadesPrevias" value="No">
                                <label for="exp_n">No</label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SECCIÓN 4: COMPROMISOS -->
            <div class="input-group-wrapper"
                style="margin-top: 40px; background: #fafbfc; border-radius: 12px; padding: 20px; border: 1px dashed var(--rcd-border);">
                <h2 class="section-title" style="border:none; margin-bottom: 15px;"><i class="fas fa-check-circle"></i>
                    Compromisos Obligatorios</h2>
                <div class="options-list">
                    <div class="option-item" style="background: white;">
                        <input type="checkbox" id="c_1" name="autorizacionResponsable" required>
                        <label for="c_1">Cuento con la autorización expresa de mi responsable directo *</label>
                    </div>
                    <div class="option-item" style="background: white;">
                        <input type="checkbox" id="c_2" name="compromisoErasmus" required>
                        <label for="c_2">Me comprometo a cumplir con los plazos y la normativa Erasmus+ *</label>
                    </div>
                    <div class="option-item" style="background: white;">
                        <input type="checkbox" id="c_3" name="declaracionResponsable" required>
                        <label for="c_3">Declaro que la información aportada es veraz y acepto las bases *</label>
                    </div>
                </div>
            </div>

            <div id="status_msg" class="msg-box"></div>

            <div class="footer-actions">
                <button type="submit" id="submit_btn" class="btn-rcd">Enviar Candidatura</button>
            </div>
        </form>
    </div>

    <script>
        // AUTO-FILL EMAIL FROM WORDPRESS LOGIN
        const wpEmail = document.getElementById('wp-user-email-hidden').textContent.trim();
        if (wpEmail && wpEmail.includes('@')) {
            const input = document.getElementById('email_input');
            input.value = wpEmail;
            input.readOnly = true;
        }

        const FORM_API = 'https://intranet-backend-one.vercel.app/api/movilidades/submit';
        const form = document.getElementById('ErasmusForm');
        const btn = document.getElementById('submit_btn');
        const box = document.getElementById('status_msg');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();

            // Validar movilidades
            const checkedDestinos = Array.from(document.querySelectorAll('input[name="paisFechas"]:checked')).map(c => c.value);
            if (checkedDestinos.length === 0) {
                showMsg('error', 'Debes seleccionar al menos un destino.');
                return;
            }

            btn.disabled = true;
            btn.textContent = 'Enviando...';
            box.style.display = 'none';

            const payload = {
                nombre: form.nombre.value,
                email: form.email.value,
                telefono: form.telefono.value,
                areaDepartamento: form.areaDepartamento.value || 'N/D',
                antiguedad: form.antiguedad.value,
                paisFechas: checkedDestinos,
                nivelIngles: form.nivelIngles.value,
                movilidadesPrevias: form.movilidadesPrevias.value,
                autorizacionResponsable: form.autorizacionResponsable.checked,
                compromisoErasmus: form.compromisoErasmus.checked,
                declaracionResponsable: form.declaracionResponsable.checked
            };

            try {
                const res = await fetch(FORM_API, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const data = await res.json();

                if (res.ok && data.success) {
                    showMsg('success', '¡Enviado con éxito! Recibirás noticias próximamente.');
                    form.reset();
                    // Recover read-only email
                    if (wpEmail) document.getElementById('email_input').value = wpEmail;
                } else {
                    showMsg('error', data.message || 'Error en el servidor.');
                }
            } catch (err) {
                showMsg('error', 'Error de conexión. Inténtalo de nuevo.');
            } finally {
                btn.disabled = false;
                btn.textContent = 'Enviar Candidatura';
            }
        });

        function showMsg(type, txt) {
            box.className = 'msg-box ' + type;
            box.textContent = txt;
            box.style.display = 'block';
            box.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
    </script>
</body>

</html>